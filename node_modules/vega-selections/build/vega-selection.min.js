var vega=function(e,t,n){"use strict";const r="intersect",i="union";var u="index:unit";function a(e,n){for(var r,i,u=n.fields,a=n.values,o=u.length,f=0;f<o;++f)if((i=u[f]).getter=t.field.getter||t.field(i.field),r=i.getter(e),t.isDate(r)&&(r=t.toNumber(r)),t.isDate(a[f])&&(a[f]=t.toNumber(a[f])),t.isDate(a[f][0])&&(a[f]=a[f].map(t.toNumber)),"E"===i.type){if(t.isArray(a[f])?a[f].indexOf(r)<0:r!==a[f])return!1}else if("R"===i.type){if(!t.inrange(r,a[f]))return!1}else if("R-RE"===i.type){if(!t.inrange(r,a[f],!0,!1))return!1}else if("R-E"===i.type){if(!t.inrange(r,a[f],!1,!1))return!1}else if("R-LE"===i.type&&!t.inrange(r,a[f],!1,!0))return!1;return!0}var o={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(e=>t.indexOf(e)>=0):t},R_union:function(e,n){var r=t.toNumber(n[0]),i=t.toNumber(n[1]);return r>i&&(r=n[1],i=n[0]),e.length?(e[0]>r&&(e[0]=r),e[1]<i&&(e[1]=i),e):[r,i]},R_intersect:function(e,n){var r=t.toNumber(n[0]),i=t.toNumber(n[1]);return r>i&&(r=n[1],i=n[0]),e.length?i<e[0]||e[1]<r?[]:(e[0]<r&&(e[0]=r),e[1]>i&&(e[1]=i),e):[r,i]}};return e.selectionResolve=function(e,n,r){for(var u,a,f,l,s,c,g,v,d,h,p,y=this.context.data[e],m=y?y.values.value:[],b={},R={},O={},E=m.length,N=0;N<E;++N){for(l=(u=m[N]).unit,a=u.fields,f=u.values,h=0,p=a.length;h<p;++h)s=a[h],g=(c=b[s.field]||(b[s.field]={}))[l]||(c[l]=[]),O[s.field]=v=s.type.charAt(0),d=o[v+"_union"],c[l]=d(g,t.array(f[h]));r&&(g=R[l]||(R[l]=[])).push(t.array(f).reduce((e,t,n)=>(e[a[n].field]=t,e),{}))}return n=n||i,Object.keys(b).forEach(e=>{b[e]=Object.keys(b[e]).map(t=>b[e][t]).reduce((t,r)=>void 0===t?r:o[O[e]+"_"+n](t,r))}),m=Object.keys(R),r&&m.length&&(b.vlMulti=n===i?{or:m.reduce((e,t)=>(e.push(...R[t]),e),[])}:{and:m.map(e=>({or:R[e]}))}),b},e.selectionTest=function(e,t,n){for(var i,o,f,l,s,c=this.context.data[e],g=c?c.values.value:[],v=c?c[u]&&c[u].value:void 0,d=n===r,h=g.length,p=0;p<h;++p)if(i=g[p],v&&d){if(-1===(f=(o=o||{})[l=i.unit]||0))continue;if(s=a(t,i),o[l]=s?-1:++f,s&&1===v.size)return!0;if(!s&&f===v.get(l).count)return!1}else if(d^(s=a(t,i)))return s;return h&&d},e.selectionVisitor=function(e,i,u,a){i[0].type!==n.Literal&&t.error("First argument to selection functions must be a string literal.");const o=i[0].value,f="unit",l="@unit",s=":"+o;(i.length>=2&&t.peek(i).value)!==r||t.hasOwnProperty(a,l)||(a["@unit"]=u.getData(o).indataRef(u,f)),t.hasOwnProperty(a,s)||(a[s]=u.getData(o).tuplesRef())},e}({},vega,vega);
//# sourceMappingURL=vega-selection.min.js.map
