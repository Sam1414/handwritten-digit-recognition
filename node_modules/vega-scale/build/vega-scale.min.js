!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports,require("vega-util"),require("d3-array"),require("d3-scale"),require("d3-interpolate"),require("vega-time")):"function"==typeof define&&define.amd?define(["exports","vega-util","d3-array","d3-scale","d3-interpolate","vega-time"],a):a((e="undefined"!=typeof globalThis?globalThis:e||self).vega={},e.vega,e.d3,e.d3,e.d3,e.vega)}(this,(function(e,a,c,n,f,t){"use strict";function d(e){if(e&&e.__esModule)return e;var a=Object.create(null);return e&&Object.keys(e).forEach((function(c){if("default"!==c){var n=Object.getOwnPropertyDescriptor(e,c);Object.defineProperty(a,c,n.get?n:{enumerable:!0,get:function(){return e[c]}})}})),a.default=e,Object.freeze(a)}var r=d(f);function i(e,a,c){const n=e-a+2*c;return e?n>0?n:1:0}const b="log",o="time",l="utc",u="continuous";function s(){let e,a,f=n.scaleOrdinal().unknown(void 0),t=f.domain,d=f.range,r=[0,1],b=!1,o=0,l=0,u=.5;function g(){let n=t().length,f=r[1]<r[0],s=r[f-0],g=r[1-f],p=i(n,o,l);e=(g-s)/(p||1),b&&(e=Math.floor(e)),s+=(g-s-e*(n-o))*u,a=e*(1-o),b&&(s=Math.round(s),a=Math.round(a));const m=c.range(n).map((function(a){return s+e*a}));return d(f?m.reverse():m)}return delete f.unknown,f.domain=function(e){return arguments.length?(t(e),g()):t()},f.range=function(e){return arguments.length?(r=[+e[0],+e[1]],g()):r.slice()},f.rangeRound=function(e){return r=[+e[0],+e[1]],b=!0,g()},f.bandwidth=function(){return a},f.step=function(){return e},f.round=function(e){return arguments.length?(b=!!e,g()):b},f.padding=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),o=l,g()):o},f.paddingInner=function(e){return arguments.length?(o=Math.max(0,Math.min(1,e)),g()):o},f.paddingOuter=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),g()):l},f.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),g()):u},f.invertRange=function(e){if(null==e[0]||null==e[1])return;let n,f,i,b=+e[0],o=+e[1],l=r[1]<r[0],u=l?d().reverse():d(),s=u.length-1;return b!=b||o!=o||(o<b&&(i=b,b=o,o=i),o<u[0]||b>r[1-l])?void 0:(n=Math.max(0,c.bisectRight(u,b)-1),f=b===o?n:c.bisectRight(u,o)-1,b-u[n]>a+1e-10&&++n,l&&(i=n,n=s-f,f=s-i),n>f?void 0:t().slice(n,f+1))},f.invert=function(e){const a=f.invertRange([e,e]);return a?a[0]:a},f.copy=function(){return s().domain(t()).range(r).round(b).paddingInner(o).paddingOuter(l).align(u)},g()}var g=Array.prototype.map;function p(e){return g.call(e,a.toNumber)}const m=Array.prototype.slice;const h={};function y(e,c,n){const f=function(){const a=c();return a.invertRange||(a.invertRange=a.invert?function(e){return function(a){let c,n=a[0],f=a[1];return f<n&&(c=n,n=f,f=c),[e.invert(n),e.invert(f)]}}(a):a.invertExtent?function(e){return function(a){let c,n,f,t,d=e.range(),r=a[0],i=a[1],b=-1;for(i<r&&(n=r,r=i,i=n),f=0,t=d.length;f<t;++f)d[f]>=r&&d[f]<=i&&(b<0&&(b=f),c=f);if(!(b<0))return r=e.invertExtent(d[b]),i=e.invertExtent(d[c]),[void 0===r[0]?r[1]:r[0],void 0===i[1]?i[0]:i[1]]}}(a):void 0),a.type=e,a};return f.metadata=a.toSet(a.array(n)),f}function v(e,a,c){return arguments.length>1?(h[e]=y(e,a,c),this):q(e)?h[e]:void 0}function q(e){return a.hasOwnProperty(h,e)}function w(e,a){const c=h[e];return c&&c.metadata[a]}function M(e){return w(e,"discrete")}function k(e){return w(e,"discretizing")}function O(e){return w(e,b)}function S(e){return w(e,"temporal")}v("identity",n.scaleIdentity),v("linear",n.scaleLinear,u),v(b,n.scaleLog,[u,b]),v("pow",n.scalePow,u),v("sqrt",n.scaleSqrt,u),v("symlog",n.scaleSymlog,u),v(o,n.scaleTime,[u,"temporal"]),v(l,n.scaleUtc,[u,"temporal"]),v("sequential",n.scaleSequential,[u,"interpolating"]),v("sequential-linear",n.scaleSequential,[u,"interpolating"]),v("sequential-log",n.scaleSequentialLog,[u,"interpolating",b]),v("sequential-pow",n.scaleSequentialPow,[u,"interpolating"]),v("sequential-sqrt",n.scaleSequentialSqrt,[u,"interpolating"]),v("sequential-symlog",n.scaleSequentialSymlog,[u,"interpolating"]),v("diverging-linear",n.scaleDiverging,[u,"interpolating"]),v("diverging-log",n.scaleDivergingLog,[u,"interpolating",b]),v("diverging-pow",n.scaleDivergingPow,[u,"interpolating"]),v("diverging-sqrt",n.scaleDivergingSqrt,[u,"interpolating"]),v("diverging-symlog",n.scaleDivergingSymlog,[u,"interpolating"]),v("quantile",n.scaleQuantile,["discretizing","quantile"]),v("quantize",n.scaleQuantize,"discretizing"),v("threshold",n.scaleThreshold,"discretizing"),v("bin-ordinal",(function e(){let f=[],t=[];function d(e){return null==e||e!=e?void 0:t[(c.bisect(f,e)-1)%t.length]}return d.domain=function(e){return arguments.length?(f=p(e),d):f.slice()},d.range=function(e){return arguments.length?(t=m.call(e),d):t.slice()},d.tickFormat=function(e,c){return n.tickFormat(f[0],a.peek(f),null==e?10:e,c)},d.copy=function(){return e().domain(d.domain()).range(d.range())},d}),["discrete","discretizing"]),v("ordinal",n.scaleOrdinal,"discrete"),v("band",s,"discrete"),v("point",(function(){return function e(a){const c=a.copy;return a.padding=a.paddingOuter,delete a.paddingInner,a.copy=function(){return e(c())},a}(s().paddingInner(1))}),"discrete");const x=["clamp","base","constant","exponent"];function B(e,a,c){return f.piecewise(G(a||"rgb",c),e)}function G(e,a){const c=r[function(e){return"interpolate"+e.toLowerCase().split("-").map((function(e){return e[0].toUpperCase()+e.slice(1)})).join("")}(e)];return null!=a&&c&&c.gamma?c.gamma(a):c}function z(e){const a=e.length/6|0,c=new Array(a);for(let n=0;n<a;)c[n]="#"+e.slice(6*n,6*++n);return c}function F(e,a){for(const c in e)T(c,a(e[c]))}const R={};function T(e,a){return e=e&&e.toLowerCase(),arguments.length>1?(R[e]=a,this):R[e]}F({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},z),F({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},e=>B(z(e)));const j=e=>a.isArray(e)?e.map(e=>String(e)):String(e),I=(e,a)=>e[1]-a[1],L=(e,a)=>a[1]-e[1];function P(e,c,n){let f=e.range(),t=f[0],d=a.peek(f),r=I;if(t>d&&(f=d,d=t,t=f,r=L),t=Math.floor(t),d=Math.ceil(d),c=c.map(a=>[a,e(a)]).filter(e=>t<=e[1]&&e[1]<=d).sort(r).map(e=>e[0]),n>0&&c.length>1){const e=[c[0],a.peek(c)];for(;c.length>n&&c.length>=3;)c=c.filter((e,a)=>!(a%2));c.length<3&&(c=e)}return c}function C(e,a){return e.bins?P(e,e.bins):e.ticks?e.ticks(a):e.domain()}function D(e,a,c,n,f,t){const d=a.type;let r=j;if(d===o||f===o)r=e.timeFormat(n);else if(d===l||f===l)r=e.utcFormat(n);else if(O(d)){const f=e.formatFloat(n);if(t||a.bins)r=f;else{const e=A(a,c,!1);r=a=>e(a)?f(a):""}}else if(a.tickFormat){const f=a.domain();r=e.formatSpan(f[0],f[f.length-1],c,n)}else n&&(r=e.format(n));return r}function A(e,a,c){const n=C(e,a),f=e.base(),t=Math.log(f),d=Math.max(1,f*a/n.length),r=e=>{let a=e/Math.pow(f,Math.round(Math.log(e)/t));return a*f<f-.5&&(a*=f),a<=d};return c?n.filter(r):r}const $={quantile:"quantiles",quantize:"thresholds",threshold:"domain"},E={quantile:"quantiles",quantize:"domain"};function Q(e,c){return e.bins?function(e){const c=e.slice(0,-1);return c.max=a.peek(e),c}(e.bins):e.type===b?A(e,c,!0):$[e.type]?function(e){const a=[-1/0].concat(e);return a.max=1/0,a}(e[$[e.type]]()):C(e,c)}function Y(e,a,c,n,f,t,d){const r=E[a.type]&&t!==o&&t!==l?function(e,a,c){let n,f=a[E[a.type]](),t=f.length,d=t>1?f[1]-f[0]:f[0];for(n=1;n<t;++n)d=Math.min(d,f[n]-f[n-1]);return e.formatSpan(0,d,30,c)}(e,a,f):D(e,a,c,f,t,d);return"symbol"===n&&(e=>$[e.type]||e.bins)(a)?N(r):"discrete"===n?_(r):V(r)}const N=e=>(a,c,n)=>{const f=U(n[c+1],U(n.max,1/0)),t=X(a,e),d=X(f,e);return t&&d?t+" – "+d:d?"< "+d:"≥ "+t},U=(e,a)=>null!=e?e:a,_=e=>(a,c)=>c?e(a):null,V=e=>a=>e(a),X=(e,a)=>Number.isFinite(e)?a(e):null;Object.defineProperty(e,"scaleImplicit",{enumerable:!0,get:function(){return n.scaleImplicit}}),e.Band="band",e.BinOrdinal="bin-ordinal",e.DiscreteLegend="discrete",e.Diverging="diverging",e.GradientLegend="gradient",e.Identity="identity",e.Linear="linear",e.Log=b,e.Ordinal="ordinal",e.Point="point",e.Pow="pow",e.Quantile="quantile",e.Quantize="quantize",e.Sequential="sequential",e.Sqrt="sqrt",e.SymbolLegend="symbol",e.Symlog="symlog",e.Threshold="threshold",e.Time=o,e.UTC=l,e.bandSpace=i,e.domainCaption=function(e,c,n){n=n||{};const f=Math.max(3,n.maxlen||7),t=function(e,c,n,f){const t=f||c.type;return a.isString(n)&&S(t)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||t!==o?n||t!==l?Y(e,c,5,null,n,f,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}(e,c,n.format,n.formatType);if(k(c.type)){const e=Q(c).slice(1).map(t),a=e.length;return`${a} boundar${1===a?"y":"ies"}: ${e.join(", ")}`}if(M(c.type)){const e=c.domain(),a=e.length;return`${a} value${1===a?"":"s"}: ${a>f?e.slice(0,f-2).map(t).join(", ")+", ending with "+e.slice(-1).map(t):e.map(t).join(", ")}`}{const e=c.domain();return`values from ${t(e[0])} to ${t(a.peek(e))}`}},e.interpolate=G,e.interpolateColors=B,e.interpolateRange=function(e,c){const n=c[0],f=a.peek(c)-n;return function(a){return e(n+a*f)}},e.isContinuous=function(e){return w(e,u)},e.isDiscrete=M,e.isDiscretizing=k,e.isInterpolating=function(e){return w(e,"interpolating")},e.isLogarithmic=O,e.isQuantile=function(e){return w(e,"quantile")},e.isTemporal=S,e.isValidScaleType=q,e.labelFormat=Y,e.labelFraction=function(e){let c=e.domain(),n=c.length-1,f=+c[0],t=+a.peek(c),d=t-f;if("threshold"===e.type){const e=n?d/n:.1;f-=e,t+=e,d=t-f}return e=>(e-f)/d},e.labelValues=Q,e.quantizeInterpolator=function(e,a){const c=new Array(a),n=a+1;for(let f=0;f<a;)c[f]=e(++f/n);return c},e.scale=v,e.scaleCopy=function(e){const a=e.type,c=e.copy();return c.type=a,c},e.scaleFraction=function(e,c,n){let f,t,d,r=n-c;return r&&Number.isFinite(r)?(f=(t=e.type).indexOf("-"),t=f<0?t:t.slice(f+1),d=v(t)().domain([c,n]).range([0,1]),x.forEach(a=>e[a]?d[a](e[a]()):0),d):a.constant(.5)},e.scheme=T,e.tickCount=function(e,c,n){let f;return a.isNumber(c)&&(e.bins&&(c=Math.max(c,e.bins.length)),null!=n&&(c=Math.min(c,Math.floor(a.span(e.domain())/n||1)))),a.isObject(c)&&(f=c.step,c=c.interval),a.isString(c)&&(c=e.type===o?t.timeInterval(c):e.type==l?t.utcInterval(c):a.error("Only time and utc scales accept interval strings."),f&&(c=c.every(f))),c},e.tickFormat=D,e.tickValues=C,e.validTicks=P,Object.defineProperty(e,"__esModule",{value:!0})}));